{% extends 'base.html' %}
{% load i18n %}
{% block title %} {{single_product.product_name}} {% endblock %}
{% block content %}
{% load static %}


<div id="page-content" class="template-product product-simple-layout">
  <!--Body Container-->
  <!--Breadcrumbs-->
  <div class="breadcrumbs-wrapper">
    <div class="container">
      <div class="breadcrumbs"><a href="{% url 'home' %}" title="Back to the home page">{% trans 'Home' %}</a> <span aria-hidden="true">|</span> <span>{{single_product.product_name}}</span></div>
    </div>
  </div>
  <div class="container">
    <div class="product-detail-container">
      <div class="product-single">
        <div class="row">
          <div class="col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="product-details-img">
              <div class="product-thumb">
                <div id="gallery" class="product-dec-slider-2 product-tab-left">
                  {% for g in gallery %}
                  <a data-image="{{g.image.url}}" data-zoom-image="{{g.image.url}}" class="slick-slide slick-cloned" data-slick-index="-4" aria-hidden="true" tabindex="-1">
                    <img class="blur-up lazyload" data-src="{{g.image.url}}" src="{{g.image.url}}" alt="" />
                  </a>
                  {% endfor %}
                </div>
              </div>
              <div class="zoompro-wrap product-zoom-right pl-20">
                {% if variant.image_id > 0 %}
                <div class="zoompro-span">
                  <img id="zoompro" class="zoompro" src="{{ variant.image }}" data-zoom-image="{{ variant.image }}" alt="" />
                </div>
                {% else %}
                <div class="zoompro-span">
                  <img id="zoompro" class="zoompro" src="{{ single_product.image.url }}" data-zoom-image="{{ single_product.image.url }}" alt="" />
                </div>
                {% endif %}
                <div class="product-buttons">
                  <a href="#" class="btn prlightbox" title="Zoom">
                    <i class="icon anm anm-expand-l-arrows" aria-hidden="true"></i>
                    <span class="tooltip-label">{% trans 'Zoom Image' %}</span>
                  </a>
                </div>
              </div>

              <div class="lightboximages">
                {% for g in gallery %}
                <a href="{{g.image.url}}" data-size="1000x1280"></a>
                {% endfor %}
              </div>

              <div class="social-sharing">
                <span class="label">{% trans 'Share' %}:</span>
                <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" class="btn btn--small btn--secondary btn--share share-facebook" title="Share on Facebook">
                  <i class="anm anm-facebook-f" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">{% trans 'Facebook' %}</span>
                </a>
                <a target="_blank" href="https://twitter.com/share?text={{single_product.product_name}}&url={{ request.build_absolute_uri }}" class="btn btn--small btn--secondary btn--share share-twitter" title="Tweet on Twitter">
                  <i class="fa fa-twitter" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">{% trans 'Twitter' %}</span>
                </a>
                <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri }}" class="btn btn--small btn--secondary btn--share share-linkedin" title="Share on LinkedIn">
                  <i class="fa fa-linkedin" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">{% trans 'LinkedIn' %}</span>
                </a>
                <a target="_blank" href="https://pinterest.com/pin/create/button/?url={{ request.build_absolute_uri }}&media=https://{{ domain }}{{ single_product.image.url }}" class="btn btn--small btn--secondary btn--share share-pinterest" title="Pin on Pinterest">
                  <i class="fa fa-pinterest" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">{% trans 'Pin it' %}</span>
                </a>
                <a href="mailto:?subject={{single_product.product_name}}&body=Check out this product {{ request.build_absolute_uri }}" class="btn btn--small btn--secondary btn--share share-pinterest" title="Share by Email" target="_blank">
                  <i class="fa fa-envelope" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">{% trans 'Email' %}</span>
                </a>
              </div>
            </div>
          </div>
          <div class="col-lg-6 col-md-6 col-sm-12 col-12">
            {% include 'includes/_alerts.html' %}
            <div class="product-single__meta">
              <h1 class="product-single__title">{{single_product.product_name}}</h1>
              <div class="prInfoRow">
                <div class="product-review">
                  <span class="reviewLink">
                    <i class="font-13 fa fa-star{% if single_product.avaregereview < 0.5 %}-o{% elif single_product.avaregereview >= 0.5 and single_product.avaregereview < 1 %}-half-o {% else %} {% endif %}"></i>
                    <i class="font-13 fa fa-star{% if single_product.avaregereview < 1.5 %}-o{% elif single_product.avaregereview >= 1.5 and single_product.avaregereview < 2 %}-half-o {% else %} {% endif %}"></i>
                    <i class="font-13 fa fa-star{% if single_product.avaregereview < 2.5 %}-o{% elif single_product.avaregereview >= 2.5 and single_product.avaregereview < 3 %}-half-o {% else %} {% endif %}"></i>
                    <i class="font-13 fa fa-star{% if single_product.avaregereview < 3.5 %}-o{% elif single_product.avaregereview >= 3.5 and single_product.avaregereview < 4 %}-half-o {% else %} {% endif %}"></i>
                    <i class="font-13 fa fa-star{% if single_product.avaregereview < 4.5 %}-o{% elif single_product.avaregereview >= 4.5 and single_product.avaregereview < 5 %}-half-o {% else %} {% endif %}"></i>
                    <span>{{ single_product.countreview}} {% trans 'reviews' %}  </span>
                  </span>
                </div>
                {% if single_product.stock <= 0 %}

                {% else %}
                <div class="product-stock"> <span class="instock ">{% trans 'In Stock' %}</span> </div>
                {% endif %}
              </div>


              <p class="product-single__price product-single__price-product-template">
                <span class="product-price__price product-price__price-product-template product-price__sale product-price__sale--single">
                  <span id="ProductPrice-product-template">
                    {% if  single_product.variant != 'None'   %}
                    <span class="money">$ <span id="varPrice">{{variant.price}}</span></span>
                    {% else %}
                    <span class="money">$ {{single_product.price}}</span>
                    {% endif %}
                  </span>
                </span>
              </p>
            </div>

            <div class="product-single__description rte">
              {{single_product.description | safe}}
            </div>


            {% if single_product.stock == 0 %}
            <div id="quantity_message">{% trans 'Sorry! This product is not available at the moment.' %}</div>
            {% endif %}
            {% if single_product.stock > 0 and single_product.stock <= 10 %}
            <div id="quantity_message">Hurry! Only <span class="items">{{single_product.stock}}</span> {% trans 'left in stock.' %}</div>
            {% endif %}

            <!-- A J A X   C A L L -->
            {% if single_product.variant == 'Custom' %}
          <script>
            $(document).ready(function() {
              url = window.location.href;
              a = url.split(/[?#]/)[0];
              window.history.replaceState(null, null, window.location.pathname);
              $('#post-form select').on('change', function(e) {
                e.preventDefault();
                productid = $('#productid').val();
                selectedKey = $(this).attr('id');
                var_value = $('#'+selectedKey).val();
                firstKey = document.querySelector('.firstloop-True').id
                firstVal = $('#'+firstKey).val();
                
                url = $('#ajaxVarUrl').val();
                


                function removeURLParameter(url, parameter) {
                  //better to use l.search if you have a location/link object
                  var urlparts= url.split('?');   
                  if (urlparts.length>=2) {

                      var prefix= encodeURIComponent(parameter)+'=';
                      var pars= urlparts[1].split(/[&;]/g);

                      //reverse iteration as may be destructive
                      for (var i= pars.length; i-- > 0;) {    
                          //idiom for string.startsWith
                          if (pars[i].lastIndexOf(prefix, 0) !== -1) {  
                              pars.splice(i, 1);
                          }
                      }

                      url= urlparts[0] + (pars.length > 0 ? '?' + pars.join('&') : "");
                      return url;
                    } else {
                        return url;
                    }
                }

                if (history.pushState) {
                    // var newurl = window.location.protocol + "//" + window.location.host + search.pathname + '?myNewUrlQuery=1';
                    var currentUrlWithOutHash = window.location.origin + window.location.pathname + window.location.search;
                    //remove any param for the same key
                    var currentUrlWithOutHash = removeURLParameter(currentUrlWithOutHash, selectedKey);
                    //figure out if we need to add the param with a ? or a &
                    var queryStart;
                    if(currentUrlWithOutHash.indexOf('?') !== -1){
                        queryStart = '&';
                    } else {
                        queryStart = '?';
                    }
                    var newurl = currentUrlWithOutHash + queryStart + selectedKey + '=' + var_value
                    window.history.pushState({path:newurl},'',newurl);
                  }

                urlParams = new URLSearchParams(window.location.search);
                urlParamsStr = urlParams.toString();
                
                $.ajax({
                  type: 'POST',
                  url: url,
                  
                  data: {
                    productid: productid,
                    selectedKey: selectedKey,
                    var_value: var_value,
                    firstKey: firstKey,
                    firstVal: firstVal,
                    urlParams: urlParamsStr,
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    action: 'post'
                  },
                  data_type: 'html',
                  success: function(data) {
                    // document.getElementById("varPrice").innerHTML = data.price;
                    $('.firstloop-True').empty();
                    $('.firstloop-False').empty();
                    $('#appendHere').html(data.rendered_table);

                    
                    let parameters = new URLSearchParams(window.location.search);
                    for(var key of parameters.keys()) {
                        v = parameters.get(key);
                        id = '#'+key
                        $(id).val(v)
                        .find("option[value=" + v +"]").attr('selected', true);
                      }
                  },
                  error: function(data) {
                    alert("Something went wrong! " + data);
                  }
                });
              });
            });
          </script>
          {% else %}
            <!-- A J A X   C A L L -->
            <script>
              $(document).on('change', '#post-form', function(e) {
                e.preventDefault();
                $.ajax({
                  type: 'POST',
                  url: '{% url "ajaxcolor" %}',
                  data: {
                    productid: $('#productid').val(),
                    size: $('#size').val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    action: 'post'
                  },
                  data_type: 'html',
                  success: function(data) {
                    console.log("success");
                    $('#appendHere').html(data.rendered_table);
                  },
                  error: function(data) {
                    alert("Something went wrong! " + data);
                  }
                });
              });
            </script>

          {% endif %}

            <!-- S I Z E   A N D   C O L O R   V A R I A N T  -->
            {% if single_product.variant == 'Size-Color' %}
            <div class="swatch clearfix swatch-1 option2" data-option-index="1">
              <div class="product-form__item p-0">
                <form method="POST" id="post-form">
                  <input type="hidden" name="productid" id="productid" value="{{ single_product.id }}">
                  <span class="text-uppercase" style="font-size:16px;font-weight:600;letter-spacing:1px;">{% trans 'Choose Size' %}</span> <br>
                  {% csrf_token %}
                  <select name="size" id="size">
                    {% for rs in sizes %}
                    <option {% if variant.size_id == rs.size_id %} selected {% endif %} value="{{ rs.size_id }}">{{ rs.size.name }}</option>
                    {% endfor %}
                  </select>
                </form>
              </div>

              <form method="post" action="?q=selectvariant" id="post-color">
                {% csrf_token %}
                <div id="appendHere">
                  <input type="hidden" name="size" id="size" value="{{ size_id }}">
                  <ul class="color-option">
                    <li><span class="text-uppercase" style="font-size:16px;font-weight:600;letter-spacing:1px;">{% trans 'Choose Color' %}</span></li> <br>
                    {% for rs in colors %}
                    <label class="var_color">
                      <input type="radio" 
                      {% if request.method == 'POST' %}
                      {% if variant.id == rs.id %}
                      checked
                      {% endif %}
                    {% endif %} name="variantid" id="variantid" required="required" value="{{ rs.id }}" onchange="this.form.submit();">
                      <li {% if variant.id == rs.id %} class="active" {% endif %}>
                        <p style="color: #2d2c2c; width: 60px;font-size: 12px;margin-bottom: 5px;margin-left: 0;">
                          <!-- ${{ rs.price }} -->
                          {{ rs.color }}
                        </p>
                        <img src="{{ rs.image }}" style="height: 50px">
                      </li>
                      
                    </label>
                    {% endfor %}
                  </ul>
                </div>
              </form>
            </div>

            <!-- C U S T O M   V A R I A N T  -->
            {% elif single_product.variant == 'Custom' %}
            <div class="swatch clearfix swatch-1 option2" data-option-index="1">
              <div class="product-form__item p-0">
                
                <form method="POST" id="post-form">
                  <div id="appendHere">
                  <input type="hidden" name="productid" id="productid" value="{{ single_product.id }}">
                  <input type="hidden" name="ajaxVarUrl" id="ajaxVarUrl" value="{% url 'ajaxVarUrl' %}">

                  {% for key, value in varDict.items %} 
                   <h3>Choose {{ key }}</h3>
                    <select name="var_value" id="{{key}}" required class="lastloop-{{forloop.last}} firstloop-{{forloop.first}} variant_select" {% if forloop.counter > 1 %}disabled{% endif %}>
                      <option value="">Select</option>
                      {% for j in value %}
                      <option value="{{j}}">{{j}}</option>
                      {% endfor %}
                    </select>
                    <br><br>
                    
                  {% endfor %}
                </div>
                </form>
                <div >
                </div>
              </div>
            </div>


            <!-- S I Z E  V A R I A N T -->
            {% elif single_product.variant == 'Size' %}
            <form method="post" action="?q=selectvariant" id="post-color">
              {% csrf_token %}
              <div id="appendHere">
                <input type="hidden" name="size" id="size" value="{{ size_id }}">
                <ul class="color-option">
                  <li><span class="text-uppercase" style="font-size:16px;font-weight:600;letter-spacing:1px;">Choose Size:</span></li> <br>
                  {% for rs in sizes %}
                  <input type="radio"
                    {% if request.method == 'POST' %}
                      {% if variant.id == rs.id %}
                      checked
                      {% endif %}
                    {% endif %} name="variantid" value="{{ rs.id }}" onchange="this.form.submit();">
                  <li {% if variant.id == rs.id %} class="active" {% endif %}>
                    <a style=" color: #204d74;  width: 90px">
                      {{ rs.size }}
                    </a>
                  </li>
                  {% endfor %}
                  
                </ul>
              </div>
            </form>
            

            <!-- C O L O R  V A R I A N T  -->
            {% elif single_product.variant == 'Color' %}
            <form method="post" action="?q=selectvariant" id="post-color">
              {% csrf_token %}
              <div id="appendHere">
                <input type="hidden" name="size" id="size" value="{{ size_id }}">
                <ul class="color-option">
                  <li><span class="text-uppercase" style="font-size:16px;font-weight:600;letter-spacing:1px;">{% trans 'choose color' %}:</span></li> <br>
                  {% for rs in colors %}
                    <label class="var_color">
                      <input type="radio"
                      {% if request.method == 'POST' %}
                      {% if variant.id == rs.id %}
                      checked
                      {% endif %}
                    {% endif %} name="variantid" id="variantid" required="required" value="{{ rs.id }}" onchange="this.form.submit();">
                      <li {% if variant.id == rs.id %} class="active" {% endif %}>
                        <p style="color: #2d2c2c;font-size: 12px; width: 60px;margin-bottom: 5px;margin-left: 0;">
                          <!-- ${{ rs.price }} -->
                          {{ rs.color }}
                        </p>
                        <img src="{{ rs.image }}" style="height: 50px">
                      </li>
                      
                    </label>
                    {% endfor %}
                </ul>
              </div>
            </form>
            
            {% endif %}

            <!-- Select Variant Error -->
            <p id="selectVariantError" class="text-danger"></p>
            <p id="outOfStockError" class="text-danger"></p>

            <p class="infolinks">
              <a class="wishlist add-to-wishlist" onclick="return addWishlist();" href="javascript:{document.getElementById('add-wishlist').submit()}" title="Add to Wishlist"><i class="icon anm anm-heart" aria-hidden="true" style="color:red;"></i> <span>{% trans 'Add to Wishlist' %}</span></a>

              {% if is_added_to_compare %}
              <a class="wishlist add-to-wishlist" href="{% url 'compare_products' %}" title="Show Comparison"><i class="fa fa-eye" aria-hidden="true"></i> <u><span>{% trans 'Show Comparison' %}</span></u></a>
              {% else %}
              <a class="wishlist add-to-wishlist" href="javascript:{document.getElementById('add-compare').submit()}" title="Add to Compare"><i class="icon anm anm-sync-ar" aria-hidden="true"></i> <span>{% trans 'Add to Compare' %}</span></a>
              {% endif %}

            </p>
            <!-- add to wishlist hidden form -->
            <form action="{% url 'add_to_wishlist' single_product.id %}" method="POST" id="add-wishlist">
              {% csrf_token %}
              <input type="hidden" name="productid" id="productid" value="{{ single_product.id }}">
              {% if single_product.variant == 'Custom' %}
                  <input type="hidden" name="variantid" id="customVariantIdWishlist" value="">
              {% else %}
                  <input type="hidden" name="variantid" id="variantid" value="{{ variant.id }}">
              {% endif %}
              <input class="input" name="size" type="hidden" value="{{ variant.size }}">
              <input class="input" name="color" type="hidden" value="{{ variant.color }}">
              <input class="input" name="quantity" type="hidden" value="1">
            </form>

            <!-- add to compare hidden form -->
            <form action="{% url 'add_to_compare' single_product.id %}" method="POST" id="add-compare">
              {% csrf_token %}
              <input type="hidden" name="productid" id="productid" value="{{ single_product.id }}">
              <input type="hidden" name="variantid" id="variantid" value="{{ variant.id }}">
              <input class="input" name="size" type="hidden" value="{{ variant.size }}">
              <input class="input" name="color" type="hidden" value="{{ variant.color }}">
              <input class="input" name="quantity" type="hidden" value="1">
            </form>
            <!-- Product Action -->

            {% if  single_product.variant != 'None'   %}
            <form action="{% url 'addtoshopcart' single_product.id %}" method="post" id="addchart-form">
              {% csrf_token %}
              <input type="hidden" name="command" id="command" value="add">
              {% if single_product.variant == 'Custom' %}
                  <input type="hidden" name="customVariantId" id="customVariantId" value="">
              {% else %}
                  <input type="hidden" name="variantid" id="variantid" value="{{ variant.id }}">
              {% endif %}
              
              <div id="SelectedProduct">
                <p><strong>Availability:</strong>
                  {% if single_product.variant != 'None' %}
                    {% if variant.quantity > 0  %} In Stock
                    {% else %} 
                    Out of Stock 
                    {% endif %}
                  {% else %}
                  {% if single_product.stock > 0  %} In Stock 
                    {% else %} 
                    Out of Stock 
                    {% endif %}
                  {% endif %}</p>
                
                <input class="input" name="size" type="hidden" value="{{ variant.size }}">
                
                <input class="input" name="color" type="hidden" value="{{ variant.color }}">
                <div class="qty-input">
                  <div class="wrapQtyBtn">
                    <div class="qtyField">
                      <span class="text-uppercase">{% trans 'QTY' %}: </span>
                      <input class="input" name="quantity" type="number" value="1" min="1" max="{{ variant.quantity }}">
                    </div>
                  </div>
                  <input type="hidden" name="variants" id="variants" value="{{single_product.variant}}">
                  <div class="addcart product-form__item--submit">
                    {% if cart_count >= 1 %}
                    <button type="submit" {% if variant.quantity < 1  %} disabled {% endif %} id="add_to_cart_btn" class="btn product-form__cart-submit add-to-cart" style="width:49%;">
                      <i class="fa fa-shopping-cart"></i><span> {% trans 'Add to cart' %}</span>
                    </button>
                    <!-- <br><br> -->
                    <a href="{% url 'shopcart' %}" class="btn product-form__cart-submit" style="background:#e95144;width:49%;">
                      <i class="fa fa-eye"></i><span> {% trans 'View Cart' %}</span>
                    </a>
                    {% else %}
                    <button type="submit" {% if variant.quantity < 1  %} disabled {% endif %} id="add_to_cart_btn" class="btn product-form__cart-submit add-to-cart">
                      <i class="fa fa-shopping-cart"></i><span> {% trans 'Add to cart' %}</span>
                    </button>
                    {% endif %}
                  </div>
                </div>
              </div>
            </form>
            {% else %}


            {% if single_product.stock <= 0 %}
            <div class="buy-it-btn">
              <button type="button" class="btn btn-danger" disabled="disabled">{% trans 'Out of Stock' %}</button>
            </div>
            {% else %}
            <div class="product-action clearfix">
              <div class="addcart product-form__item--submit" style="padding-left:0px;">
                <a href="{% url 'addtoshopcart' single_product.id %}" name="add" class="btn product-form__cart-submit" style="color:#fff !important;">
                  {% trans 'Add to cart' %}
                </a>
              </div>
              
            </div>
            {% endif %}

            {% endif %}

            <!-- End Product Action -->
            <!-- </form> -->
            
            <!-- <p id="freeShipMsg" class="freeShipMsg" data-price="199"><i class="fa fa-truck" aria-hidden="true"></i> Getting Closer! Only <b class="freeShip"><span class="money" data-currency-usd="$199.00" data-currency="USD">$199.00</span></b> Away
              From <b>FREE SHIPPING!</b></p>
            <p class="shippingMsg"><i class="fa fa-clock-o" aria-hidden="true"></i> Estimated Delivery Between <b id="fromDate">Wed. May 1</b> and <b id="toDate">Tue. May 7</b>.</p> -->
<br><br>
            <!-- Inquiry modal -->
            <button type="button" onclick="DrawCaptchaInq()" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter" style="width:100%;">
              {% trans 'Send an Inquiry' %} 
            </button>

            <!-- Modal -->
            <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">{% trans 'SEND AN INQUIRY' %}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>


                  <div class="modal-body">
                    <form action="#" method="POST" id="inquiry-modal">
                      {% csrf_token %}
                      <input type="hidden" name="business_id" id="business_id" value="{{business.business_id}}">
                      {% if user.is_authenticated %}
                      <input type="hidden" name="user_id" id="user_id" value="{{user.id}}">
                      {% else %}
                      <input type="hidden" name="user_id" id="user_id" value="0">
                      {% endif %}

                      <input type="hidden" name="product_id" id="product_id" value="{{single_product.id}}">
                      <h5>{% trans 'Please fill below form to inquire about this product.' %}</h5>
                      <p id="blankCaptchaErrorInq" style="color: #e95144;"></p>
                      <div class="form-group">
                        <input type="text" name="product_name" id="product_name" class="form-control" value="{{ single_product.product_name }}" readonly>
                      </div>
                      <div class="form-group">
                        <div class="row">
                          <div class="col">
                            <input type="text" name="first_name" id="first_name" class="form-control" placeholder="{% trans 'First Name' %}" {% if user.is_authenticated %} value="{{user.first_name}}" {% endif %} required>
                          </div>
                          <div class="col">
                            <input type="text" name="last_name" id="last_name" class="form-control" placeholder="{% trans 'Last Name' %}" {% if user.is_authenticated %} value="{{user.last_name}}" {% endif %} required>
                          </div>
                        </div>
                      </div>
                      <div class="form-group">
                        <div class="row">
                          <div class="col">
                            <input type="email" name="email" id="email" class="form-control" placeholder="{% trans 'Email Address' %}" {% if user.is_authenticated %} value="{{user.email}}" {% endif %} required>
                          </div>
                          <div class="col">
                            <input type="number" name="phone" id="phone" class="inputNumber"  maxlength="12"oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);" placeholder="{% trans 'Phone Number' %}" class="form-control" required>
                          </div>
                        </div>
                      </div>

                      <div class="form-group">
                        <textarea name="message" id="inq_message" class="form-control" placeholder="{% trans 'Enter your message here' %}" required></textarea>
                      </div>
                      <hr>

                      <table>
                        <tr>
                          <td>
                            <div class="container" id="captchaRating">
                             
                              <div class="row">
                                <div class="col pl-0">
                                    <input type="text" id="txtInputInq" placeholder="{% trans 'Enter Captcha' %}" class="form-control"/>

                                </div>
                                <div class="col pr-0">
                                  <input type="text" id="txtCaptchaInq" style="background-image:url({% static 'images/default-images/captcha-bg.jpg' %}); text-align:center; font-size:20px; border:none;
                  font-weight:bold; font-family:Modern"/>
                                  <i class="fa fa-refresh" aria-hidden="true" onclick="DrawCaptchaInq();" style="font-size:24px;cursor:pointer;float:right;"></i>
                                </div>
                              </div>
                            </div>


                          </td>
                        </tr>
                        <tr>
                          <td>

                          </td>
                        </tr>
                      </table>
                      <p id="invalidCodeInq" style="color: #e95144;"></p>
                      <input type="hidden" name="url" id="url" value="{% url 'inquiry' %}">

                      <input type="submit" name="submit" id="submit" value="Send Inquiry" class="btn btn-block btn-danger" onclick="return ValidCaptchaInq();">
                    </form>
                  </div>
                  <div class="modal-footer">
                    <p id="inquiry_success"></p>
                    <p id="captcha_message"></p>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">{% trans 'Close' %}</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container" >
      <div class="row" style="margin-top: 50px;">
        <div class="col-md-12">
          <h3>{% trans 'PRODUCT DETAILS' %}</h3>
          <div style="margin-top: 20px;">
            <div class="product-description rte">
              {{single_product.full_specification | safe}}
            </div>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top: 50px;">
        <div class="col-md-12">
          <h3>{% trans 'REVIEWS' %}</h3>
          <div id="tab2" class="tab-content">
            <div class="row">
              <div class="col-12 col-sm-12 col-md-6 col-lg-6 mb-4">
                <div class="spr-form clearfix">
                  <form method="post" action="{% if user.is_authenticated %}{% url 'submit_review' single_product.id %}{% else %}#{% endif %}" id="new-review-form" class="new-review-form">
                    {% csrf_token %}
                    <h3 class="spr-form-title">{% trans 'Write Your Review' %}</h3>
                    <fieldset class="spr-form-contact">
                      <div class="spr-form-review-rating">
                        <p class="spr-form-label">{% trans 'How do you rate this product?' %}<span class="required">*</span></p>
                        <!-- Rating -->
                        <div class="rate">
                          <input type="radio" id="rating10" name="rating" value="5" required /><label for="rating10" title="5"></label>
                          <input type="radio" id="rating9" name="rating" value="4.5" required /><label class="half" for="rating9" title="4.5"></label>
                          <input type="radio" id="rating8" name="rating" value="4" required /><label for="rating8" title="4"></label>
                          <input type="radio" id="rating7" name="rating" value="3.5" required /><label class="half" for="rating7" title="3.5"></label>
                          <input type="radio" id="rating6" name="rating" value="3" required /><label for="rating6" title="3"></label>
                          <input type="radio" id="rating5" name="rating" value="2.5" required /><label class="half" for="rating5" title="2.5"></label>
                          <input type="radio" id="rating4" name="rating" value="2" required /><label for="rating4" title="2"></label>
                          <input type="radio" id="rating3" name="rating" value="1.5" required /><label class="half" for="rating3" title="1.5"></label>
                          <input type="radio" id="rating2" name="rating" value="1" required /><label for="rating2" title="1"></label>
                          <input type="radio" id="rating1" name="rating" value="0.5" required /><label class="half" for="rating1" title="0.5"></label>
                        </div>
                      <p class="text-danger" id="ratingError"></p>
  
                      </div>
                    </fieldset>
                    <fieldset class="spr-form-review">
                      <div class="spr-form-review-title">
                        <p class="spr-form-label" for="review">{% trans 'Review Title' %}</p>
                        <input class="spr-form-input spr-form-input-text " id="subject" type="text" name="subject" required >
                      </div>
  
                      <div class="spr-form-review-body">
                        <p class="spr-form-label" for="review">{% trans 'Review' %}</p>
                        <div class="spr-form-input">
                          <textarea class="spr-form-input spr-form-input-textarea" id="review" name="review" rows="5" required></textarea>
                        </div>
                      </div>
                    </fieldset>
                    {% if user.is_authenticated %}
                        {% if orderproduct %}
                    <div class="spr-form-actions">

                      <div class="container">
                        <div class="row">
                          <div class="col pl-0">
                              <input type="text" id="txtInputRating" placeholder="{% trans 'Enter Captcha' %}" class="form-control"/>

                          </div>
                          <div class="col pr-0">
                            <input type="text" id="txtCaptchaRating" style="background-image:url({% static 'images/default-images/captcha-bg.jpg' %}); text-align:center; font-size:20px; border:none;
            font-weight:bold; font-family:Modern"/>
                            <i class="fa fa-refresh" aria-hidden="true" onclick="DrawCaptchaRating();" style="font-size:24px;cursor:pointer;float:right;"></i>
                          </div>
                        </div>
                      </div>
                      <p id="invalidCodeRating" style="color: #e95144;"></p>
                      <p id="blankCaptchaErrorRating" style="color: #e95144;"></p>
                      <p class="mb-1 font-italic text-muted">{% trans 'Please note, reviews must be approved before they are published' %}</p>
                      <input type="submit" class="spr-button spr-button-primary button button-primary btn btn-primary" value="Submit Review" onclick="checkforFields(); return ValidCaptchaRating();">
                   
                    </div>
                    
                        {% else %}
                        <p>{% trans 'You must purchase this product to write a review.' %}</p>
                        {% endif %}
                    {% else %}
                    <p>{% trans 'You must be logged in to post a review.' %} <span><a href="{% url 'userLogin' %}"><u>{% trans 'Login now' %}</u></a></span></p>
  
                    {% endif %}
                  </form>
                </div>
              </div>
  
              <div class="col-12 col-sm-12 col-md-6 col-lg-6">
                <div class="spr-reviews">
                  <h3 class="spr-form-title">{% trans 'Customer Reviews' %} </h3>
                  
                    <h4 class="product-review spr-starratings spr-review-header-starratings" style="text-transform: unset;">
                      <span class="reviewLink">
                        <i class="font-13 fa fa-star{% if single_product.avaregereview < 0.5 %}-o{% elif single_product.avaregereview >= 0.5 and single_product.avaregereview < 1 %}-half-o {% else %} {% endif %}"></i>
                        <i class="font-13 fa fa-star{% if single_product.avaregereview < 1.5 %}-o{% elif single_product.avaregereview >= 1.5 and single_product.avaregereview < 2 %}-half-o {% else %} {% endif %}"></i>
                        <i class="font-13 fa fa-star{% if single_product.avaregereview < 2.5 %}-o{% elif single_product.avaregereview >= 2.5 and single_product.avaregereview < 3 %}-half-o {% else %} {% endif %}"></i>
                        <i class="font-13 fa fa-star{% if single_product.avaregereview < 3.5 %}-o{% elif single_product.avaregereview >= 3.5 and single_product.avaregereview < 4 %}-half-o {% else %} {% endif %}"></i>
                        <i class="font-13 fa fa-star{% if single_product.avaregereview < 4.5 %}-o{% elif single_product.avaregereview >= 4.5 and single_product.avaregereview < 5 %}-half-o {% else %} {% endif %}"></i>
                      </span>
                      {% if single_product.avaregereview  %}
{{ single_product.avaregereview }} out of 5
                      {% else %}
                      Not rated yet
                      {% endif %}
                    </h4>
                  
                    <hr>
  
                  {% if not reviews %}
                  <h6 style="margin-top:30px;">{% trans 'Be the first to review this product.' %}</h6>
                  {% else %}
  
                  <div class="review-inner">
                    {% for review in reviews %}
                    <div class="spr-review">
                      <div class="spr-review-header">
  
                        <span class="product-review spr-starratings spr-review-header-starratings">
                          <span class="reviewLink">
                            <i class="font-13 fa fa-star{% if review.rating == 0.5 %}-half-o{% elif review.rating < 1 %}-o empty{% endif %}"></i>
                            <i class="font-13 fa fa-star{% if review.rating == 1.5 %}-half-o{% elif review.rating < 2 %}-o empty{% endif %}"></i>
                            <i class="font-13 fa fa-star{% if review.rating == 2.5 %}-half-o{% elif review.rating < 3 %}-o empty{% endif %}"></i>
                            <i class="font-13 fa fa-star{% if review.rating == 3.5 %}-half-o{% elif review.rating < 4 %}-o empty{% endif %}"></i>
                            <i class="font-13 fa fa-star{% if review.rating == 4.5 %}-half-o{% elif review.rating < 5 %}-o empty{% endif %}"></i>
                          </span>
                        </span>
  
                        <h3 class="spr-review-header-title">{{review.subject}}</h3>
                        <span class="spr-review-header-byline"><strong>{{review.user.name}}</strong> {% trans 'on' %} <strong>{{review.update_at}}</strong></span>
                      </div>
                      <div class="spr-review-content">
                        <p class="spr-review-content-body">{{ review.review }}</p>
                      </div>
                    </div>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>


  </div>
  <!--End Body Container-->

</div>

<script>

function addWishlist(){
  var variant = $("#variants").val()
      if(variant == 'Size'){
          if (!$("input[name='variantid']:checked").val()) {
          document.getElementById("selectVariantError").innerHTML = "{% trans 'Please choose size' %}";
          return false;
        }
      }
      else if(variant == 'Color'){
        if (!$("input[name='variantid']:checked").val()) {
          document.getElementById("selectVariantError").innerHTML = "{% trans 'Please choose color' %}";
          return false;
        }
      }
      else if(variant == 'Size-Color'){
        if(!$("input[name='variantid']:checked").val()) {
          document.getElementById("selectVariantError").innerHTML = "{% trans 'Please choose color' %}";
            return false;
          }
      }
      else if(variant == 'Custom'){
        var customVariantId = document.getElementById("customVariantId").value;
        
        if(customVariantId == '' ){
          document.getElementById("selectVariantError").innerHTML = "{% trans 'Please select all fields' %}";
            return false;
          }
      }
}

function checkforFields(){
  var rating = $('input[name="rating"]:checked').val();
  if( typeof rating === 'undefined' || rating === null ){
    document.getElementById("ratingError").innerHTML = "{% trans 'Please select a rating star!' %}";
    return false;
    }
  }

  $(document).ready(function() {
    $("input[name$='rating']").click(function() {
      $('#ratingError').empty();
    });


    $('#add_to_cart_btn').click(function() {
      var variant = $("#variants").val()
      if(variant == 'Size'){
          if (!$("input[name='variantid']:checked").val()) {
          document.getElementById("selectVariantError").innerHTML = "{% trans 'Please choose size' %}";
          return false;
        }
      }
      else if(variant == 'Color'){
        if (!$("input[name='variantid']:checked").val()) {
          document.getElementById("selectVariantError").innerHTML = "{% trans 'Please choose color' %}";
          return false;
        }
      }
      else if(variant == 'Size-Color'){
        if(!$("input[name='variantid']:checked").val()) {
          document.getElementById("selectVariantError").innerHTML = "{% trans 'Please choose color' %}";
            return false;
          }
      }
      else if(variant == 'Custom'){
        var customVariantId = document.getElementById("customVariantId").value;
        
        if(customVariantId == '' ){
          document.getElementById("selectVariantError").innerHTML = "{% trans 'Please select all fields' %}";
            return false;
          }
      }
    
  });
  
});

</script>
{% endblock %}
